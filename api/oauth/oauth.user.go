package oauth

import (
	"base/helpers"
	"base/interfaces"
)

//||------------------------------------------------------------------------------------------------||
//|| Create Response
//||------------------------------------------------------------------------------------------------||

func CreateUserResponse(myCookie string) interfaces.OAuthUser {

	//||------------------------------------------------------------------------------------------------||
	//|| OAuth User
	//||------------------------------------------------------------------------------------------------||

	user := interfaces.OAuthUser{
		ID:            "-1",
		Status:        "NONE",
		Username:      "Anonymous",
		Verifications: []interfaces.OAuthVerification{},
	}

	//||------------------------------------------------------------------------------------------------||
	//|| No Login
	//||------------------------------------------------------------------------------------------------||

	if myCookie == "" {
		return user
	}

	//||------------------------------------------------------------------------------------------------||
	//|| Get Session Record
	//||------------------------------------------------------------------------------------------------||

	session, err := helpers.FetchSession(myCookie)
	if err != nil {
		return user
	}

	//||------------------------------------------------------------------------------------------------||
	//|| If Session
	//||------------------------------------------------------------------------------------------------||

	if err == nil {
		user.ID = session.ID
		user.Status = session.Status
		user.Username = session.Username
	}

	//||------------------------------------------------------------------------------------------------||
	//|| Get Verifications
	//||------------------------------------------------------------------------------------------------||

	verifications, err := helpers.OAuthVerifications(session.ID)
	if err == nil {
		user.Verifications = verifications
	}

	//||------------------------------------------------------------------------------------------------||
	//|| Done
	//||------------------------------------------------------------------------------------------------||

	return user
}
